Local == "Lagoa da Confusao" ~ "10°47' 37'' S",
TRUE ~ as.character(Latit)
),
Longit = case_when(
Local == "Pium" ~ "49°15' 1.4'' W",
Local == "Paraiso do Tocantins" ~ "48°40' 54.6'' W",
Local == "Goiania" ~ "49°30' 11'' W",
Local == "Pedro Afonso" ~ "48°10' 29'' W",
Local == "Aparecida do Rio Negro" ~ "47°58' 19'' W",
Local == "Lagoa da Confusao" ~ "49°37' 25'' W",
TRUE ~ as.character(Longit)
)) |>
mutate(Latitude = char2dms(from = Latit,chd = "°", chm = "'", chs = "''")
|> as.numeric()) |>
mutate(Longitude = char2dms(from = Longit,chd = "°", chm = "'", chs = "''")
|> as.numeric())
# correcting planting dates
# corrigindo as datas de plantio
soybean_data <- soybean_data |>
mutate(Plantio = case_when(
Plantio == "2022-01-17" ~ as.Date("2022-11-17"),
Plantio == "2021-11-23" ~ as.Date("2022-11-23"),
TRUE ~ as.Date(Plantio)),
Colheita = Plantio+Ciclo)
# creating the harvest cycle categorical covariate
# criando a covariável categórica de ciclo de colheita
soybean_data <- soybean_data |>
mutate(Ciclo4 = cut(x = Ciclo, breaks = c(-Inf, 100, 110, 120, Inf),
labels = c("Super Precoce","Precoce","Medio","Tardio")))
View(soybean_data)
??lubridate
??`lubridate-package`
month("2022-11-23")
year("2022-11-23")
?month
names(soybean_data)
?combine
?combine_vars
clima <- soybean_data |>
select(Plantio, Colheita) |>
mutate(Plant = c(month(Plantio, label = TRUE, abbr = TRUE), year(Plantio)))
clima <- soybean_data |>
select(Plantio, Colheita) |>
mutate(mesP = month(Plantio, label = TRUE, abbr = TRUE), anoP = year(Plantio),
mesC = month(Colheita, label = TRUE, abbr = TRUE), anoC = year(Colheita),
Plant = combine(mesP, anoP))
?cbind
clima <- soybean_data |>
select(Plantio, Colheita) |>
mutate(mesP = month(Plantio, label = TRUE, abbr = TRUE), anoP = year(Plantio),
mesC = month(Colheita, label = TRUE, abbr = TRUE), anoC = year(Colheita),
Plant = cbind(mesP, anoP))
View(clima)
clima <- soybean_data |>
select(Plantio, Colheita) |>
mutate(mesP = month(Plantio, label = TRUE, abbr = TRUE), anoP = year(Plantio),
mesC = month(Colheita, label = TRUE, abbr = TRUE), anoC = year(Colheita),
Plant = rbind(mesP, anoP))
clima <- soybean_data |>
select(Plantio, Colheita) |>
mutate(mesP = month(Plantio, label = TRUE, abbr = TRUE), anoP = year(Plantio),
mesC = month(Colheita, label = TRUE, abbr = TRUE), anoC = year(Colheita),
Plant = make_date(anoP, mesP))
View(clima)
View(clima)
table(clima$mesP, clima$anoP)
View(soybean_data)
clima <- soybean_data |>
select(Local,Plantio, Colheita) |>
mutate(mesP = month(Plantio, label = TRUE, abbr = TRUE), anoP = year(Plantio),
mesC = month(Colheita, label = TRUE, abbr = TRUE), anoC = year(Colheita),
Plant = rbind(mesP, anoP))
clima <- soybean_data |>
select(Local,Plantio, Colheita) |>
mutate(mesP = month(Plantio, label = TRUE, abbr = TRUE), anoP = year(Plantio),
mesC = month(Colheita, label = TRUE, abbr = TRUE), anoC = year(Colheita))
View(clima)
table(clima$anoP, clima$mesP)
table(clima$anoP, clima$mesP)
table(clima$mesP, clima$anoP)
table(clima$mesC, clima$anoC)
attach(clima)
table(anoC, mesP, anoP)
table(mesP, anoP, anoC)
table(mesP, anoP, mesC)
# creating oceanic season variable
clima <- clima |>
mutate(tempeture = case_when(
year(Plantio) == 2017 & month(Plantio) == 11 & year(Colheita) == 2018 & month(Colheita) == 3 ~ mean(-0.7,-0.8,-1.0,-0.9,-0.9,-0.7,-0.5),
year(Plantio) == 2017 & month(Plantio) == 11 & year(Colheita) == 2018 & month(Colheita) == 4 ~ mean(-0.7,-0.8,-1.0,-0.9,-0.9,-0.7,-0.5,-0.2),
year(Plantio) == 2017 & month(Plantio) == 11 & year(Colheita) == 2018 & month(Colheita) == 2 ~ mean(-0.7,-0.8,-1.0,-0.9,-0.9,-0.7),
year(Plantio) == 2019 & month(Plantio) == 11 & year(Colheita) == 2020 & month(Colheita) == 2 ~ mean(0.3,0.5,0.5,0.5,0.5,0.4),
year(Plantio) == 2019 & month(Plantio) == 11 & year(Colheita) == 2020 & month(Colheita) == 3 ~ mean(0.3,0.5,0.5,0.5,0.5,0.4,0.2),
year(Plantio) == 2020 & month(Plantio) == 11 & year(Colheita) == 2021 & month(Colheita) == 2 ~ mean(-1.2,-1.3,-1.2,-1.0,-0.9,-0.8),
year(Plantio) == 2020 & month(Plantio) == 11 & year(Colheita) == 2021 & month(Colheita) == 3 ~ mean(-1.2,-1.3,-1.2,-1.0,-0.9,-0.8,-0.7),
year(Plantio) == 2021 & month(Plantio) == 10 & year(Colheita) == 2022 & month(Colheita) == 2 ~ mean(-0.7,-0.8,-1.0,-1.0,-1.0,-0.9,-1.0),
year(Plantio) == 2021 & month(Plantio) == 11 & year(Colheita) == 2022 & month(Colheita) == 3 ~ mean(-0.8,-1.0,-1.0,-1.0,-0.9,-1.0,-1.1),
year(Plantio) == 2022 & month(Plantio) == 11 & year(Colheita) == 2023 & month(Colheita) == 2 ~ mean(-1.0,-0.9,-0.8,-0.7,-0.4,-0.1),
year(Plantio) == 2022 & month(Plantio) == 11 & year(Colheita) == 2023 & month(Colheita) == 3 ~ mean(-1.0,-0.9,-0.8,-0.7,-0.4,-0.1,0.2),
)) |>
mutate(caracteristica = cut(tempeture, breaks = c(-Inf, -0.5, 0.5, Inf), labels = c("laNina", "neutro", "elNino")))
View(clima)
table(caracteristica)
table(clima$caracteristica)
library(xlsx)
library(tidyverse)
library(sp)
# loading principal data file
main_data <- read.xlsx("Data/Dados - Produtividade em Latossolo e Plintossolo - 2018 a 2023.xlsx", sheetIndex = 1)
main_data <- main_data[,1:12]
soybean_data <- main_data |>
# removing accents
# removendo acentos
mutate_at(vars(Local, Textura.do.solo, Cultivar),
~stringi::stri_trans_general(.,"Latin-ASCII")) |>
# transforming categorical variables
# transformando variáveis categóricas
mutate_at(vars(Local,Ano,Solo,Cultivar, Textura.do.solo), as.factor) |>
#transforming the Date covariate
# transformando a covariável de Data
mutate_at(vars(Plantio), as.Date)
# correcting coordinates
soybean_data <- soybean_data |>
separate(Lat..e.Long., into = c("Latit", "Longit"), sep = ";") |>
mutate(Latit = case_when(
Local == "Pium" ~ "10°12' 58'' S",
Local == "Paraiso do Tocantins" ~ "10°11' 16.9'' S",
Local == "Pedro Afonso" ~ "08°58' 03'' S",
Local == "Aparecida do Rio Negro" ~ "09°57' 07'' S",
Local == "Lagoa da Confusao" ~ "10°47' 37'' S",
TRUE ~ as.character(Latit)
),
Longit = case_when(
Local == "Pium" ~ "49°15' 1.4'' W",
Local == "Paraiso do Tocantins" ~ "48°40' 54.6'' W",
Local == "Goiania" ~ "49°30' 11'' W",
Local == "Pedro Afonso" ~ "48°10' 29'' W",
Local == "Aparecida do Rio Negro" ~ "47°58' 19'' W",
Local == "Lagoa da Confusao" ~ "49°37' 25'' W",
TRUE ~ as.character(Longit)
)) |>
mutate(Latitude = char2dms(from = Latit,chd = "°", chm = "'", chs = "''")
|> as.numeric()) |>
mutate(Longitude = char2dms(from = Longit,chd = "°", chm = "'", chs = "''")
|> as.numeric())
# correcting planting dates
# corrigindo as datas de plantio
soybean_data <- soybean_data |>
mutate(Plantio = case_when(
Plantio == "2022-01-17" ~ as.Date("2022-11-17"),
Plantio == "2021-11-23" ~ as.Date("2022-11-23"),
TRUE ~ as.Date(Plantio)),
Colheita = Plantio+Ciclo)
# creating the harvest cycle categorical covariate
# criando a covariável categórica de ciclo de colheita
soybean_data <- soybean_data |>
mutate(Ciclo4 = cut(x = Ciclo, breaks = c(-Inf, 100, 110, 120, Inf),
labels = c("Super Precoce","Precoce","Medio","Tardio")))
# creating oceanic season variable
clima <- clima |>
mutate(tempeture = case_when(
year(Plantio) == 2017 & month(Plantio) == 11 & year(Colheita) == 2018 & month(Colheita) == 3 ~ mean(-0.7,-0.8,-1.0,-0.9,-0.9,-0.7,-0.5),
year(Plantio) == 2017 & month(Plantio) == 11 & year(Colheita) == 2018 & month(Colheita) == 4 ~ mean(-0.7,-0.8,-1.0,-0.9,-0.9,-0.7,-0.5,-0.2),
year(Plantio) == 2017 & month(Plantio) == 11 & year(Colheita) == 2018 & month(Colheita) == 2 ~ mean(-0.7,-0.8,-1.0,-0.9,-0.9,-0.7),
year(Plantio) == 2019 & month(Plantio) == 11 & year(Colheita) == 2020 & month(Colheita) == 2 ~ mean(0.3,0.5,0.5,0.5,0.5,0.4),
year(Plantio) == 2019 & month(Plantio) == 11 & year(Colheita) == 2020 & month(Colheita) == 3 ~ mean(0.3,0.5,0.5,0.5,0.5,0.4,0.2),
year(Plantio) == 2020 & month(Plantio) == 11 & year(Colheita) == 2021 & month(Colheita) == 2 ~ mean(-1.2,-1.3,-1.2,-1.0,-0.9,-0.8),
year(Plantio) == 2020 & month(Plantio) == 11 & year(Colheita) == 2021 & month(Colheita) == 3 ~ mean(-1.2,-1.3,-1.2,-1.0,-0.9,-0.8,-0.7),
year(Plantio) == 2021 & month(Plantio) == 10 & year(Colheita) == 2022 & month(Colheita) == 2 ~ mean(-0.7,-0.8,-1.0,-1.0,-1.0,-0.9,-1.0),
year(Plantio) == 2021 & month(Plantio) == 11 & year(Colheita) == 2022 & month(Colheita) == 3 ~ mean(-0.8,-1.0,-1.0,-1.0,-0.9,-1.0,-1.1),
year(Plantio) == 2022 & month(Plantio) == 11 & year(Colheita) == 2023 & month(Colheita) == 2 ~ mean(-1.0,-0.9,-0.8,-0.7,-0.4,-0.1),
year(Plantio) == 2022 & month(Plantio) == 11 & year(Colheita) == 2023 & month(Colheita) == 3 ~ mean(-1.0,-0.9,-0.8,-0.7,-0.4,-0.1,0.2),
)) |>
mutate(caracteristica = cut(tempeture, breaks = c(-Inf, -0.5, 0.5, Inf), labels = c("laNina", "neutro", "elNino")))
# creating oceanic season variable
soybean_data <- soybean_data |>
mutate(tempeture = case_when(
year(Plantio) == 2017 & month(Plantio) == 11 & year(Colheita) == 2018 & month(Colheita) == 3 ~ mean(-0.7,-0.8,-1.0,-0.9,-0.9,-0.7,-0.5),
year(Plantio) == 2017 & month(Plantio) == 11 & year(Colheita) == 2018 & month(Colheita) == 4 ~ mean(-0.7,-0.8,-1.0,-0.9,-0.9,-0.7,-0.5,-0.2),
year(Plantio) == 2017 & month(Plantio) == 11 & year(Colheita) == 2018 & month(Colheita) == 2 ~ mean(-0.7,-0.8,-1.0,-0.9,-0.9,-0.7),
year(Plantio) == 2019 & month(Plantio) == 11 & year(Colheita) == 2020 & month(Colheita) == 2 ~ mean(0.3,0.5,0.5,0.5,0.5,0.4),
year(Plantio) == 2019 & month(Plantio) == 11 & year(Colheita) == 2020 & month(Colheita) == 3 ~ mean(0.3,0.5,0.5,0.5,0.5,0.4,0.2),
year(Plantio) == 2020 & month(Plantio) == 11 & year(Colheita) == 2021 & month(Colheita) == 2 ~ mean(-1.2,-1.3,-1.2,-1.0,-0.9,-0.8),
year(Plantio) == 2020 & month(Plantio) == 11 & year(Colheita) == 2021 & month(Colheita) == 3 ~ mean(-1.2,-1.3,-1.2,-1.0,-0.9,-0.8,-0.7),
year(Plantio) == 2021 & month(Plantio) == 10 & year(Colheita) == 2022 & month(Colheita) == 2 ~ mean(-0.7,-0.8,-1.0,-1.0,-1.0,-0.9,-1.0),
year(Plantio) == 2021 & month(Plantio) == 11 & year(Colheita) == 2022 & month(Colheita) == 3 ~ mean(-0.8,-1.0,-1.0,-1.0,-0.9,-1.0,-1.1),
year(Plantio) == 2022 & month(Plantio) == 11 & year(Colheita) == 2023 & month(Colheita) == 2 ~ mean(-1.0,-0.9,-0.8,-0.7,-0.4,-0.1),
year(Plantio) == 2022 & month(Plantio) == 11 & year(Colheita) == 2023 & month(Colheita) == 3 ~ mean(-1.0,-0.9,-0.8,-0.7,-0.4,-0.1,0.2),
)) |>
mutate(caracteristica = cut(tempeture, breaks = c(-Inf, -0.5, 0.5, Inf), labels = c("laNina", "neutro", "elNino")))
table(soybean_data$caracteristica)
table(soybean_data$tempeture)
is.na(soybean_data$tempeture)
View(soybean_data)
# creating oceanic season variable
soybean_data <- soybean_data |>
mutate(tempeture = case_when(
year(Plantio) == 2017 & month(Plantio) == 11 & year(Colheita) == 2018 & month(Colheita) == 3 ~ mean(-0.7,-0.8,-1.0,-0.9,-0.9,-0.7,-0.5),
year(Plantio) == 2017 & month(Plantio) == 11 & year(Colheita) == 2018 & month(Colheita) == 4 ~ mean(-0.7,-0.8,-1.0,-0.9,-0.9,-0.7,-0.5,-0.2),
year(Plantio) == 2017 & month(Plantio) == 11 & year(Colheita) == 2018 & month(Colheita) == 2 ~ mean(-0.7,-0.8,-1.0,-0.9,-0.9,-0.7),
year(Plantio) == 2017 & month(Plantio) == 12 & year(Colheita) == 2018 & month(Colheita) == 3 ~ mean(-0.8,-1.0,-0.9,-0.9,-0.7,-0.5),
year(Plantio) == 2017 & month(Plantio) == 12 & year(Colheita) == 2018 & month(Colheita) == 4 ~ mean(-0.8,-1.0,-0.9,-0.9,-0.7,-0.5,-0.2),
year(Plantio) == 2019 & month(Plantio) == 11 & year(Colheita) == 2020 & month(Colheita) == 2 ~ mean(0.3,0.5,0.5,0.5,0.5,0.4),
year(Plantio) == 2019 & month(Plantio) == 11 & year(Colheita) == 2020 & month(Colheita) == 3 ~ mean(0.3,0.5,0.5,0.5,0.5,0.4,0.2),
year(Plantio) == 2020 & month(Plantio) == 11 & year(Colheita) == 2021 & month(Colheita) == 2 ~ mean(-1.2,-1.3,-1.2,-1.0,-0.9,-0.8),
year(Plantio) == 2020 & month(Plantio) == 11 & year(Colheita) == 2021 & month(Colheita) == 3 ~ mean(-1.2,-1.3,-1.2,-1.0,-0.9,-0.8,-0.7),
year(Plantio) == 2021 & month(Plantio) == 10 & year(Colheita) == 2022 & month(Colheita) == 2 ~ mean(-0.7,-0.8,-1.0,-1.0,-1.0,-0.9,-1.0),
year(Plantio) == 2021 & month(Plantio) == 11 & year(Colheita) == 2022 & month(Colheita) == 3 ~ mean(-0.8,-1.0,-1.0,-1.0,-0.9,-1.0,-1.1),
year(Plantio) == 2022 & month(Plantio) == 11 & year(Colheita) == 2023 & month(Colheita) == 2 ~ mean(-1.0,-0.9,-0.8,-0.7,-0.4,-0.1),
year(Plantio) == 2022 & month(Plantio) == 11 & year(Colheita) == 2023 & month(Colheita) == 3 ~ mean(-1.0,-0.9,-0.8,-0.7,-0.4,-0.1,0.2),
)) |>
mutate(caracteristica = cut(tempeture, breaks = c(-2, -0.5, 0.5, 2), labels = c("laNina", "neutro", "elNino")))
table(soybean_data$caracteristica)
sum(is.na(soybean_data$caracteristica))
sum(is.na(soybean_data$tempeture))
sum(is.na(soybean_data))
View(soybean_data)
soybean_data <- soybean_data |>
mutate(tha = kgha/1000)
soybean_data <- soybean_data |>
mutate(tha = kgha/1000) |>
mutate(Grupo = case_when(
Solo == "Latossolo" & Ciclo4 == "Super Precoce" & Clima == "laNina" ~ "G1",
Solo == "Latossolo" & Ciclo4 == "Super Precoce" & Clima == "neutro" ~ "G2",
Solo == "Plintossolo" & Ciclo4 == "Super Precoce" & Clima == "laNina" ~ "G3",
Solo == "Plintossolo" & Ciclo4 == "Super Precoce" & Clima == "neutro" ~ "G4",
Solo == "Latossolo" & Ciclo4 == "Precoce" & Clima == "laNina" ~ "G5",
Solo == "Latossolo" & Ciclo4 == "Precoce" & Clima == "neutro" ~ "G6",
Solo == "Plintossolo" & Ciclo4 == "Precoce" & Clima == "laNina" ~ "G7",
Solo == "Plintossolo" & Ciclo4 == "Precoce" & Clima == "neutro" ~ "G8",
Solo == "Latossolo" & Ciclo4 == "Medio" & Clima == "laNina" ~ "G9",
Solo == "Latossolo" & Ciclo4 == "Medio" & Clima == "neutro" ~ "G10",
Solo == "Plintossolo" & Ciclo4 == "Medio" & Clima == "laNina" ~ "G11",
Solo == "Plintossolo" & Ciclo4 == "Medio" & Clima == "neutro" ~ "G12",
Solo == "Latossolo" & Ciclo4 == "Tardio" & Clima == "laNina" ~ "G13",
Solo == "Latossolo" & Ciclo4 == "Tardio" & Clima == "neutro" ~ "G14",
Solo == "Plintossolo" & Ciclo4 == "Tardio" & Clima == "laNina" ~ "G15",
Solo == "Plintossolo" & Ciclo4 == "Tardio" & Clima == "neutro" ~ "G16",
.default = "outro"
)) |>
mutate(Grupo = factor(Grupo, levels = c("G1", "G2", "G3", "G4", "G5", "G6", "G7", "G8", "G9",
"G10", "G11", "G12", "G13", "G14", "G15", "G16")))
soybean_data <- soybean_data |>
mutate(tha = kgha/1000) |>
mutate(Grupo = case_when(
Solo == "Latossolo" & Ciclo4 == "Super Precoce" & caracteristica == "laNina" ~ "G1",
Solo == "Latossolo" & Ciclo4 == "Super Precoce" & caracteristica == "neutro" ~ "G2",
Solo == "Plintossolo" & Ciclo4 == "Super Precoce" & caracteristica == "laNina" ~ "G3",
Solo == "Plintossolo" & Ciclo4 == "Super Precoce" & caracteristica == "neutro" ~ "G4",
Solo == "Latossolo" & Ciclo4 == "Precoce" & caracteristica == "laNina" ~ "G5",
Solo == "Latossolo" & Ciclo4 == "Precoce" & caracteristica == "neutro" ~ "G6",
Solo == "Plintossolo" & Ciclo4 == "Precoce" & caracteristica == "laNina" ~ "G7",
Solo == "Plintossolo" & Ciclo4 == "Precoce" & caracteristica == "neutro" ~ "G8",
Solo == "Latossolo" & Ciclo4 == "Medio" & caracteristica == "laNina" ~ "G9",
Solo == "Latossolo" & Ciclo4 == "Medio" & caracteristica == "neutro" ~ "G10",
Solo == "Plintossolo" & Ciclo4 == "Medio" & caracteristica == "laNina" ~ "G11",
Solo == "Plintossolo" & Ciclo4 == "Medio" & caracteristica == "neutro" ~ "G12",
Solo == "Latossolo" & Ciclo4 == "Tardio" & caracteristica == "laNina" ~ "G13",
Solo == "Latossolo" & Ciclo4 == "Tardio" & caracteristica == "neutro" ~ "G14",
Solo == "Plintossolo" & Ciclo4 == "Tardio" & caracteristica == "laNina" ~ "G15",
Solo == "Plintossolo" & Ciclo4 == "Tardio" & caracteristica == "neutro" ~ "G16",
.default = "outro"
)) |>
mutate(Grupo = factor(Grupo, levels = c("G1", "G2", "G3", "G4", "G5", "G6", "G7", "G8", "G9",
"G10", "G11", "G12", "G13", "G14", "G15", "G16")))
View(soybean_data)
# gráfico do perfil médio do Clima
ggplot(data = soybean_data, mapping = aes(x = Ciclo, y = kgha)) +
stat_summary(aes(colour = caracteristica) ,fun = "mean", geom = "line")
# gráfico do perfil médio do Solo
ggplot(data = soybean_data, mapping = aes(x = Ano, y = kgha)) +
stat_summary(aes(colour = Solo), fun = "mean", geom = "line") +
scale_x_continuous(breaks = unique(Ano))
# gráfico do perfil médio do Solo
ggplot(data = soybean_data, mapping = aes(x = Ano, y = kgha)) +
stat_summary(aes(colour = Solo), fun = "mean", geom = "line")
# gráfico do perfil médio do Solo
ggplot(data = soybean_data, mapping = aes(x = Ano, y = kgha)) +
stat_summary(aes(colour = Solo), fun = "mean", geom = "line") +
scale_x_continuous(breaks = unique(as.numeric(Ano)))
# gráfico do perfil médio do Solo
ggplot(data = soybean_data, mapping = aes(x = as.numeric(Ano), y = kgha)) +
stat_summary(aes(colour = Solo), fun = "mean", geom = "line") +
scale_x_continuous(breaks = unique(as.numeric(Ano)))
names(soybean_data)
# gráfico do perfil médio do Solo
ggplot(data = soybean_data, mapping = aes(x = as.numeric(Ano), y = kgha)) +
stat_summary(aes(colour = Solo), fun = "mean", geom = "line") +
scale_x_continuous(breaks = unique(as.numeric(Ano)))
install.packages("nlme")
library(nlme)
# mod com interação tripla
mod1 <- lme(kgha ~ Solo*Ciclo4*caracteristica, data = soybean_data, random = ~1|Cultivar)
summary(mod1)
# mod com interações duplas
mod2 <- lme(fixed = kgha ~ Solo*Ciclo4 + Solo*caracteristica + Ciclo4*caracteristica,
data = soybean_data, random = ~1|Cultivar)
summary(mod2)
# mod sem interação Solo caracteristica
mod3 <- lme(fixed = kgha ~ Solo*Ciclo4 + Ciclo4*caracteristica,
data = soybean_data, random = ~1|Cultivar)
mod3 <- lmerTest::lmer(kgha ~ Solo*Ciclo4 + Ciclo4*caracteristica + (1|Cultivar), soybean_data)
summary(mod3)
# mod com a covar Grupo
mod4 <- lmerTest::lmer(formula = kgha ~ Grupo + (1|Cultivar), data = soybean_data)
summary(mod4)
# removendo os níveis não significativos G4, G8
mod41 <- lmerTest::lmer(kgha ~ Grupo2 + (1|Cultivar), soybean_data)
# removendo os níveis não significativos G4, G8
mod41 <- lmerTest::lmer(kgha ~ Grupo + (1|Cultivar), soybean_data,
subset = !(Grupo %in% c("G4","G8","G11")))
summary(mod41)
# mod usando gls - generalized least squares
mod5 <- gls(model = kgha ~ Grupo, data = soybean_data, weights = varIdent(form = ~1|Cultivar))
summary(mod5)
# mod removendo os níveis não significativos G4, G7, G11
mod51 <- gls(model = kgha ~ Grupo, data = soybean_data, weights = varIdent(form = ~1|Cultivar),
subset = !(Grupo %in% c("G4","G7","G11")))
summary(mod51)
rm(mod5)
rm(mod51)
sjPlot::plot_model(mod4, type = "int")
sjPlot::plot_model(mod4, type = "diag")
# mod com a covar Grupo
# mod4 <- lmerTest::lmer(formula = kgha ~ Grupo + (1|Cultivar), data = soybean_data)
mod4 <- lme(fixed = kgha ~ Grupo, data = soybean_data, random = ~1|Cultivar)
# Resíduos vs Valores Ajustados
plot(mod4)
# Q-Qplot dos resíduos
qqnorm(mod4)
# plot do ajustado pelo observado
plot(mod4, kgha ~ fitted(.))
# Q-Qplot dos efeitos aleatórios
qqnorm(mod4, ~ranef(.))
# boxplot dos resíduos por Cultivar
plot(mod4, Cultivar~resid(., type = "p"), abline = 0, xlim = c(-4.5,4.5))
# Resíduos vs Valores Ajustados por Solo
plot(mod4, resid(., type = "p")~fitted(.)|Solo)
# Resíduos vs Valores Ajustados
plot(mod5.gls)
# mod usando gls - generalized least squares
mod5.gls <- gls(model = kgha ~ Grupo, data = soybean_data, weights = varIdent(form = ~1|Cultivar))
anova(mod4, mod5.gls)
View(soybean_data)
unique(c(soybean_data$Local, soybean_data$Ano))
library(tidyverse)
rm(list = ls())
library(xlsx)
library(tidyverse)
library(sp)
library(nlme)
# loading principal data file
main_data <- read.xlsx("Data/Dados - Produtividade em Latossolo e Plintossolo - 2018 a 2023.xlsx", sheetIndex = 1)
main_data <- main_data[,1:12]
soybean_data <- main_data |>
# removing accents
# removendo acentos
mutate_at(vars(Local, Textura.do.solo, Cultivar),
~stringi::stri_trans_general(.,"Latin-ASCII")) |>
# transforming categorical variables
# transformando variáveis categóricas
mutate_at(vars(Local,Ano,Solo,Cultivar, Textura.do.solo), as.factor) |>
#transforming the Date covariate
# transformando a covariável de Data
mutate_at(vars(Plantio), as.Date)
# correcting coordinates
soybean_data <- soybean_data |>
separate(Lat..e.Long., into = c("Latit", "Longit"), sep = ";") |>
mutate(Latit = case_when(
Local == "Pium" ~ "10°12' 58'' S",
Local == "Paraiso do Tocantins" ~ "10°11' 16.9'' S",
Local == "Pedro Afonso" ~ "08°58' 03'' S",
Local == "Aparecida do Rio Negro" ~ "09°57' 07'' S",
Local == "Lagoa da Confusao" ~ "10°47' 37'' S",
TRUE ~ as.character(Latit)
),
Longit = case_when(
Local == "Pium" ~ "49°15' 1.4'' W",
Local == "Paraiso do Tocantins" ~ "48°40' 54.6'' W",
Local == "Goiania" ~ "49°30' 11'' W",
Local == "Pedro Afonso" ~ "48°10' 29'' W",
Local == "Aparecida do Rio Negro" ~ "47°58' 19'' W",
Local == "Lagoa da Confusao" ~ "49°37' 25'' W",
TRUE ~ as.character(Longit)
)) |>
mutate(Latitude = char2dms(from = Latit,chd = "°", chm = "'", chs = "''")
|> as.numeric()) |>
mutate(Longitude = char2dms(from = Longit,chd = "°", chm = "'", chs = "''")
|> as.numeric())
# correcting planting dates
# corrigindo as datas de plantio
soybean_data <- soybean_data |>
mutate(Plantio = case_when(
Plantio == "2022-01-17" ~ as.Date("2022-11-17"),
Plantio == "2021-11-23" ~ as.Date("2022-11-23"),
TRUE ~ as.Date(Plantio)),
Colheita = Plantio+Ciclo)
# creating the harvest cycle categorical covariate
# criando a covariável categórica de ciclo de colheita
soybean_data <- soybean_data |>
mutate(Ciclo4 = cut(x = Ciclo, breaks = c(-Inf, 100, 110, 120, Inf),
labels = c("Super Precoce","Precoce","Medio","Tardio"))) |>
# creating an identifier
mutate(idCombi = as.factor(paste(Local, Ano, Ciclo4, sep = "_")),
id = as.numeric(idCombi))
# creating oceanic season variable
soybean_data <- soybean_data |>
mutate(tempeture = case_when(
year(Plantio) == 2017 & month(Plantio) == 11 & year(Colheita) == 2018 & month(Colheita) == 3 ~ mean(-0.7,-0.8,-1.0,-0.9,-0.9,-0.7,-0.5),
year(Plantio) == 2017 & month(Plantio) == 11 & year(Colheita) == 2018 & month(Colheita) == 4 ~ mean(-0.7,-0.8,-1.0,-0.9,-0.9,-0.7,-0.5,-0.2),
year(Plantio) == 2017 & month(Plantio) == 11 & year(Colheita) == 2018 & month(Colheita) == 2 ~ mean(-0.7,-0.8,-1.0,-0.9,-0.9,-0.7),
year(Plantio) == 2017 & month(Plantio) == 12 & year(Colheita) == 2018 & month(Colheita) == 3 ~ mean(-0.8,-1.0,-0.9,-0.9,-0.7,-0.5),
year(Plantio) == 2017 & month(Plantio) == 12 & year(Colheita) == 2018 & month(Colheita) == 4 ~ mean(-0.8,-1.0,-0.9,-0.9,-0.7,-0.5,-0.2),
year(Plantio) == 2019 & month(Plantio) == 11 & year(Colheita) == 2020 & month(Colheita) == 2 ~ mean(0.3,0.5,0.5,0.5,0.5,0.4),
year(Plantio) == 2019 & month(Plantio) == 11 & year(Colheita) == 2020 & month(Colheita) == 3 ~ mean(0.3,0.5,0.5,0.5,0.5,0.4,0.2),
year(Plantio) == 2020 & month(Plantio) == 11 & year(Colheita) == 2021 & month(Colheita) == 2 ~ mean(-1.2,-1.3,-1.2,-1.0,-0.9,-0.8),
year(Plantio) == 2020 & month(Plantio) == 11 & year(Colheita) == 2021 & month(Colheita) == 3 ~ mean(-1.2,-1.3,-1.2,-1.0,-0.9,-0.8,-0.7),
year(Plantio) == 2021 & month(Plantio) == 10 & year(Colheita) == 2022 & month(Colheita) == 2 ~ mean(-0.7,-0.8,-1.0,-1.0,-1.0,-0.9,-1.0),
year(Plantio) == 2021 & month(Plantio) == 11 & year(Colheita) == 2022 & month(Colheita) == 3 ~ mean(-0.8,-1.0,-1.0,-1.0,-0.9,-1.0,-1.1),
year(Plantio) == 2022 & month(Plantio) == 11 & year(Colheita) == 2023 & month(Colheita) == 2 ~ mean(-1.0,-0.9,-0.8,-0.7,-0.4,-0.1),
year(Plantio) == 2022 & month(Plantio) == 11 & year(Colheita) == 2023 & month(Colheita) == 3 ~ mean(-1.0,-0.9,-0.8,-0.7,-0.4,-0.1,0.2),
)) |>
mutate(caracteristica = cut(tempeture, breaks = c(-2, -0.5, 0.5, 2), labels = c("laNina", "neutro", "elNino")))
soybean_data <- soybean_data |>
mutate(tha = kgha/1000) |>
mutate(Grupo = case_when(
Solo == "Latossolo" & Ciclo4 == "Super Precoce" & caracteristica == "laNina" ~ "G1",
Solo == "Latossolo" & Ciclo4 == "Super Precoce" & caracteristica == "neutro" ~ "G2",
Solo == "Plintossolo" & Ciclo4 == "Super Precoce" & caracteristica == "laNina" ~ "G3",
Solo == "Plintossolo" & Ciclo4 == "Super Precoce" & caracteristica == "neutro" ~ "G4",
Solo == "Latossolo" & Ciclo4 == "Precoce" & caracteristica == "laNina" ~ "G5",
Solo == "Latossolo" & Ciclo4 == "Precoce" & caracteristica == "neutro" ~ "G6",
Solo == "Plintossolo" & Ciclo4 == "Precoce" & caracteristica == "laNina" ~ "G7",
Solo == "Plintossolo" & Ciclo4 == "Precoce" & caracteristica == "neutro" ~ "G8",
Solo == "Latossolo" & Ciclo4 == "Medio" & caracteristica == "laNina" ~ "G9",
Solo == "Latossolo" & Ciclo4 == "Medio" & caracteristica == "neutro" ~ "G10",
Solo == "Plintossolo" & Ciclo4 == "Medio" & caracteristica == "laNina" ~ "G11",
Solo == "Plintossolo" & Ciclo4 == "Medio" & caracteristica == "neutro" ~ "G12",
Solo == "Latossolo" & Ciclo4 == "Tardio" & caracteristica == "laNina" ~ "G13",
Solo == "Latossolo" & Ciclo4 == "Tardio" & caracteristica == "neutro" ~ "G14",
Solo == "Plintossolo" & Ciclo4 == "Tardio" & caracteristica == "laNina" ~ "G15",
Solo == "Plintossolo" & Ciclo4 == "Tardio" & caracteristica == "neutro" ~ "G16",
.default = "outro"
)) |>
mutate(Grupo = factor(Grupo, levels = c("G1", "G2", "G3", "G4", "G5", "G6", "G7", "G8", "G9",
"G10", "G11", "G12", "G13", "G14", "G15", "G16")))
View(soybean_data)
table(soybean_data$Ciclo4)
##### Densidade por tipo de Solo #####
sample_size = soybean_data %>% group_by(Solo) %>% summarize(num=n())
soybean_data %>%
left_join(sample_size) %>%
mutate(myaxis = paste0(Solo, "\n", "n=", num)) %>%
ggplot(aes(x=myaxis, y=kgha)) +
geom_violin(width=1.4, aes(fill = Solo)) +
# scale_fill_viridis(discrete = TRUE) +
# theme_ipsum() +
theme(
legend.position="none",
plot.title = element_text(size=11)
) +
ggtitle("Densidade da produtividade de Soja por Solo") +
xlab("")
##### Densidade por ANO #####
sample_size = soybean_data %>% group_by(Ano) %>% summarize(num=n())
soybean_data %>%
left_join(sample_size) %>%
mutate(myaxis = paste0(Ano, "\n", "n=", num)) %>%
ggplot(aes(x=myaxis, y=kgha, fill=Ano)) +
geom_violin(width=1.4) +
# scale_fill_viridis(discrete = TRUE) +
# theme_ipsum() +
theme(
legend.position="none",
plot.title = element_text(size=11)
) +
ggtitle("Densidade da produtividade de Soja por Ano") +
xlab("")
##### Densidade por Grupo do Ciclo #####
soybean_data |>
ggplot(mapping = aes(x = Ciclo4, y = kgha)) +
geom_violin()
##### Densidade por Grupo do Ciclo e SOLO #####
sample_size = soybean_data %>% group_by(Ciclo4, Solo) %>% summarize(num=n())
soybean_data %>%
left_join(sample_size) %>%
mutate(myaxis = paste0(Ciclo4, "\n", Solo, "\n", "n=", num)) %>%
ggplot(aes(x=myaxis, y=kgha)) +
geom_violin(width=1.4, aes(fill = Solo)) +
# scale_fill_viridis(discrete = TRUE) +
# theme_ipsum() +
theme(
legend.position="none",
plot.title = element_text(size=11)
) +
ggtitle("Densidade da produtividade de Soja por Ano e Solo") +
xlab("")
##### Densidade por Grupo do Ciclo e SOLO #####
sample_size = soybean_data %>% group_by(Solo, Ciclo4) %>% summarize(num=n())
soybean_data %>%
left_join(sample_size) %>%
mutate(myaxis = paste0(Solo, "\n", Ciclo4, "\n", "n=", num)) %>%
ggplot(aes(x=myaxis, y=kgha)) +
geom_violin(width=1.4, aes(fill = Solo)) +
# scale_fill_viridis(discrete = TRUE) +
# theme_ipsum() +
theme(
legend.position="none",
plot.title = element_text(size=11)
) +
ggtitle("Densidade da produtividade de Soja por Ano e Solo") +
xlab("")
